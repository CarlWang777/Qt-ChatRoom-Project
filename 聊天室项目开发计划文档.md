# 聊天室项目开发计划文档

本文档记录了聊天室项目从一个本地验证程序，逐步演进为一个功能性网络应用的核心开发思路与阶段性目标。

## 1. 项目初始状态 (Phase 0)

项目初期已成功实现了一个基于本地文件 (`data.txt`) 的用户系统，具备以下功能：

*   **用户注册**：允许新用户创建账户。
*   **用户登录**：验证用户输入的凭据是否正确。
*   **界面分离**：通过 `chatDialog` 和 `registerdialog` 两个独立的窗口处理登录和注册流程。

**核心局限**：所有操作均为本地化，缺乏网络能力，且代码结构有待优化。

---

## 2. 第一阶段：代码重构与安全增强

在进入网络开发之前，我们对现有代码进行了一次重要的重构，旨在提升代码质量、可维护性和安全性。

### 2.1 关注点分离：创建 `UserManager` 类

*   **问题**：用户数据的处理逻辑（文件读写、密码验证）与界面逻辑（`chatDialog`, `registerdialog`）高度耦合。
*   **解决方案**：创建一个独立的 `UserManager` 类，将所有与用户数据相关的操作（增、查、改）全部封装进去。
*   **收益**：
    *   **解耦**：UI 类不再关心数据如何存储和验证，只负责调用 `UserManager` 的接口。
    *   **复用**：未来任何需要用户管理功能的地方，都可以复用 `UserManager`。
    *   **清晰**：代码职责分明，为后续将验证逻辑迁移到服务器端打下基础。

### 2.2 安全增强：密码哈希存储

*   **问题**：初始版本以明文形式在 `data.txt` 中存储密码，存在严重安全隐患。
*   **解决方案**：在 `UserManager` 中引入 `QCryptographicHash` (SHA-256)，在存储和验证密码时，只处理密码的**哈希值**，而非原文。
*   **收益**：
    *   **安全性**：即使数据文件泄露，攻击者也无法直接获取用户的原始密码。

### 2.3 成果

完成此阶段后，项目代码结构更加健壮和安全，为后续的功能扩展做好了充分准备。

---

## 3. 第二阶段：引入主窗口与应用流程改造

此阶段的核心目标是打通应用程序的核心流程：**从登录成功到进入主功能界面**。

### 3.1 蓝图设计：创建主聊天窗口 (`MainWindow`)

*   **目标**：创建一个作为用户登录后主要操作界面的新窗口。
*   **实现思路**：
    1.  使用 Qt Creator 创建一个新的 `QMainWindow` 类，命名为 `MainWindow`。
    2.  在 `mainwindow.ui` 设计器中，搭建聊天界面的基本框架，至少包含：
        *   `QTextBrowser`：用于显示聊天记录。
        *   `QLineEdit`：用于输入待发送的消息。
        *   `QPushButton`：用于触发“发送”动作。
        *   `QListWidget`：用于未来显示在线用户列表。

### 3.2 流程改造：修改程序入口 (`main.cpp`)

*   **目标**：改变程序启动后的流程，实现窗口间的跳转。
*   **实现思路**：
    1.  修改 `main.cpp`，使 `chatDialog`（登录窗口）以**模态 (Modal)** 方式启动 (`dialog.exec()`)。这将阻塞程序的执行，直到登录窗口关闭。
    2.  检查 `chatDialog` 的返回值。
    3.  **如果返回 `QDialog::Accepted` (登录成功)**：则创建并显示 `MainWindow` 实例，程序进入主界面。
    4.  **如果返回 `QDialog::Rejected` (用户取消或关闭窗口)**：则程序直接退出。

### 3.3 信息传递：建立窗口间的“桥梁”

*   **目标**：让 `MainWindow` 知道当前是哪个用户登录了。
*   **实现思路**：
    1.  在 `chatDialog` 类中，增加一个公共成员函数（如 `currentUsername()`），用于返回登录成功的用户名。
    2.  在 `main.cpp` 中，当 `chatDialog` 返回成功后，调用此函数获取用户名。
    3.  为 `MainWindow` 的构造函数增加一个 `QString` 类型的参数，用于接收用户名。
    4.  在 `main.cpp` 创建 `MainWindow` 实例时，将获取到的用户名传递进去。

---

## 总结与下一阶段目标

完成第二阶段后，项目将达成一个关键里程碑：

> **程序能够实现从启动、用户登录到进入主功能界面的完整流程。**

这标志着应用程序的“骨架”已经搭建完毕。接下来的第三阶段，将是在 `MainWindow` 中引入 `QTcpSocket`，开始激动人心的网络编程，真正实现客户端与服务器的通信。